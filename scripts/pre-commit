#!/bin/bash

# Pre-commit hooks for Katya AI REChain Mesh
# Install with: ln -s ../../scripts/pre-commit .git/hooks/pre-commit

echo "ğŸ” Running pre-commit checks..."

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo "âŒ Not in a git repository"
    exit 1
fi

# Run Flutter format
echo "ğŸ“ Formatting code..."
if ! dart format --set-exit-if-changed . > /dev/null 2>&1; then
    echo "âŒ Code formatting failed"
    echo "ğŸ’¡ Run 'dart format .' to fix formatting issues"
    exit 1
fi

# Check for uncommitted changes from formatting
if ! git diff --quiet; then
    echo "ğŸ“ Code formatted. Adding changes..."
    git add .
fi

# Run analyzer
echo "ğŸ” Running analyzer..."
if ! flutter analyze > /dev/null 2>&1; then
    echo "âŒ Code analysis failed"
    echo "ğŸ’¡ Fix the issues above before committing"
    exit 1
fi

# Run tests
echo "ğŸ§ª Running tests..."
if ! flutter test > /dev/null 2>&1; then
    echo "âŒ Tests failed"
    echo "ğŸ’¡ Fix failing tests before committing"
    exit 1
fi

echo "âœ… All checks passed! Ready to commit."
exit 0

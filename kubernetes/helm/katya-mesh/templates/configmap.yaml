apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "katya-mesh.fullname" . }}-config
  labels:
    {{- include "katya-mesh.labels" . | nindent 4 }}
data:
  config.yaml: |
    protocol: {{ .Values.config.protocol }}
    maxPeers: {{ .Values.config.maxPeers }}
    heartbeatInterval: {{ .Values.config.heartbeatInterval }}
    enableEncryption: {{ .Values.config.enableEncryption }}
    enableCompression: {{ .Values.config.enableCompression }}

    # Kubernetes-specific configuration
    kubernetes:
      namespace: {{ .Release.Namespace }}
      serviceAccount: {{ include "katya-mesh.serviceAccountName" . }}
      clusterDomain: cluster.local

    # Discovery configuration
    discovery:
      kubernetes: true
      multicast: false
      dns: false

    # Crypto configuration
    crypto:
      keySize: 32
      hashAlgorithm: sha256
      cipherAlgorithm: aes-gcm

    # Network configuration
    network:
      listenAddress: "0.0.0.0:8080"
      advertiseAddress: "$(POD_IP):8080"
      grpcListenAddress: "0.0.0.0:9090"

    # Logging configuration
    logging:
      level: info
      format: json
      output: stdout

    # Metrics configuration
    metrics:
      enabled: true
      path: /metrics
      address: "0.0.0.0:9091"
